on:
  issue_comment:
    types: [created]
jobs:
  confirm-diff:
    name: confirm diff
    runs-on: ubuntu-latest
    steps:
      -
        name: tell user that PR requires check
        run: |
          cat ${GITHUB_EVENT_PATH}
          is_pr="$(jq -r 'if .issue.pull_request then true else false end' < ${GITHUB_EVENT_PATH})"
          if [[ "$is_pr" != "true" ]]; then
            exit 0
          fi
          body="$(jq -r .comment.body < ${GITHUB_EVENT_PATH})"
          if [[ "$body" != "accept diff" ]]; then
            exit 0
          fi
          pr_url=$(jq -r .issue.pull_request.url < ${GITHUB_EVENT_PATH})
          statuses_url="$(curl -sS \
            -H "authorization: Bearer ${{ secrets.GITHUB_TOKEN }}" \
            ${pr_url} | \
            jq -r .statuses_url)"
          payload="$(echo '{"state":"success","context":"check-diff"}' | jq .)"
          curl -sS -XPOST \
            -H "authorization: Bearer ${{ secrets.GITHUB_TOKEN }}" \
            -H "content-type: application/json" \
            -d "${payload}" \
            ${statuses_url}
